<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three.js Lighting Demo</title>
    <style>
        body {
            margin: 0;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <!-- 引入 Three.js 库 -->
    <script type="module">
        import * as THREE from '/build/three.module.min.js';

        // 1. 创建场景
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xeeeeee);

        // 2. 创建相机
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;  // 设置相机位置
        // 3. 创建渲染器
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);  // 设置渲染器的大小与浏览器窗口一致
        document.body.appendChild(renderer.domElement);  // 将渲染器的 canvas 插入到页面中

        // 4. 创建光源
        const ambientLight = new THREE.AmbientLight(0x404040, 2);  // 环境光，弱光照亮整个场景
        const pointLight = new THREE.PointLight(0xffffff, 2, 100);  // 点光源，白色，强度 2，距离 100
        pointLight.position.set(5, 5, 5);  // 设置光源
        scene.add(ambientLight);
        scene.add(pointLight);

        // 5.创建多个物体
        const geometryCube = new THREE.BoxGeometry(1, 1, 1);  // 创建一个立方体几何体 1、1、1长宽高
        const materialCube = new THREE.MeshStandardMaterial({ color: 0x0077ff });  // 蓝色材质
        const cube = new THREE.Mesh(geometryCube, materialCube);
        cube.position.set(-2, 0, 0);  // 设置立方体位置

        const geometrySphere = new THREE.SphereGeometry(0.5, 32, 32);  // 创建一个球体几何体，半径 0.5 32代表分段数
        const materialSphere = new THREE.MeshStandardMaterial({ color: 0xff5500 });  // 橙色材质
        const sphere = new THREE.Mesh(geometrySphere, materialSphere);
        sphere.position.set(2, 0, 0);  // 设置球体位置

        scene.add(cube);  // 将立方体添加到场景中
        scene.add(sphere);  // 将球体添加到场景中

        // 6. 创建raycaster和鼠标坐标
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        // 7. 添加鼠标点击事件监听器
        function onMouseClick(event) {
            // 将鼠标坐标转换为标准化设备坐标 (-1 到 +1)
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            // 更新射线
            // raycaster.update();
            raycaster.setFromCamera(mouse, camera);

            // 计算与物体的交点
            const intersects = raycaster.intersectObjects(scene.children);

            if (intersects.length > 0) {
                // 如果有交点，获取第一个交点
                const intersectedObject = intersects[0].object;

                // 改变物体颜色
                if (intersectedObject.material instanceof THREE.MeshStandardMaterial) {
                    intersectedObject.material.color.set(Math.random() * 0xffffff);  // 随机颜色
                }
            }

        }


        // 8. 添加事件监听器
        window.addEventListener('click', onMouseClick, false);


        // 9. 创建渲染函数
        function animate() {
            requestAnimationFrame(animate);

            // 让物体缓慢旋转
            cube.rotation.x += 0.01;
            cube.rotation.y += 0.01;
            sphere.rotation.x += 0.01;
            sphere.rotation.y += 0.01;

            // 渲染场景
            renderer.render(scene, camera);
        }

        animate();  // 启动动画
    </script>
</body>

</html>